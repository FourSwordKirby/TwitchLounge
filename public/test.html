<!doctype html>
<html>
  <head>
    <title>test</title>
<script src="http://code.jquery.com/jquery-1.11.1.js"></script>
<script src="https://ttv-api.s3.amazonaws.com/twitch.min.js"></script>

  <body>
    TEST
    Using this page to handle a user's first time visiting our site and saving their access token
    Which acts then like a never ending session lmao
  </body>


<script>
Twitch.init({clientId: 'oqg26g9cdo8gkqy7puez3370gudujjk'}, function(error, status) {
    var token = Twitch.getToken();
    Twitch.api({method: '/user'}, function(err, result) {
        $.ajax({
            url: '/db/saveUser',
            type: 'PUT',
            data: {
                "user" : result,
                "token" : token
            }
        }).done(function() {
            localStorage.setItem('lounge_token', token);
            localStorage.setItem('twitch_id', result._id);
        })
    });

// TODO: Save access token to a user?
// Send a request to the server. Create a user, and save twitch username, accesstoken. Etc.

// 1. Check if the user is currently streaming. IF so, create room. Otherwise ... redirect to prev page probably

});



</script>

</html>